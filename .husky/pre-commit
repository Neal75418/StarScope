#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# æª¢æŸ¥æ˜¯å¦æœ‰ GitHub Personal Access Token æ´©éœ²
echo "ğŸ” æª¢æŸ¥æ•æ„Ÿè³‡æ–™..."
if git diff --cached --diff-filter=d | grep -E "(ghp_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})"; then
  echo "âŒ éŒ¯èª¤ï¼šæª¢æ¸¬åˆ°ç–‘ä¼¼ GitHub Token"
  echo "   è«‹å‹¿æäº¤çœŸå¯¦çš„ GitHub Token"
  echo "   æ’é™¤çš„æª”æ¡ˆï¼š.env.example, src/i18n/translations.ts (é€™äº›æª”æ¡ˆä½¿ç”¨ä½”ä½ç¬¦)"
  exit 1
fi

# æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–å¸¸è¦‹çš„æ•æ„Ÿè³‡æ–™
if git diff --cached --diff-filter=d | grep -iE "(password\s*=\s*['\"][^'\"]+['\"]|api[_-]?key\s*=\s*['\"][^'\"]+['\"]|secret\s*=\s*['\"][^'\"]+['\"])"; then
  echo "âš ï¸  è­¦å‘Šï¼šæª¢æ¸¬åˆ°å¯èƒ½çš„æ•æ„Ÿè³‡æ–™ (password/api_key/secret)"
  echo "   è«‹ç¢ºèªé€™ä¸æ˜¯çœŸå¯¦çš„æ†‘è­‰"
  # é€™è£¡åªæ˜¯è­¦å‘Šï¼Œä¸é˜»æ“‹æäº¤ï¼ˆå› ç‚ºå¯èƒ½æœ‰èª¤åˆ¤ï¼‰
fi

echo "âœ… æ•æ„Ÿè³‡æ–™æª¢æŸ¥é€šé"

# åŸ·è¡Œ lint-staged
npx lint-staged
